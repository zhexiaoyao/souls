# 魂类游戏图形引擎开发计划表

## 项目概述
- **项目名称**: Souls-Like 轻量化魂游图形引擎
- **开发周期**: 2个月（8周）
- **团队规模**: 2人
- **技术栈**: OpenGL + C++17
- **目标**: 完成所有基础功能（35分）+ 部分高级功能（争取40分）

---

## 阶段划分

### 第一阶段：引擎基础架构（第1-2周）
**目标**: 搭建项目框架，实现核心渲染管线

#### 第1周：项目初始化与基础渲染
- [ ] **Day 1-2**: 项目搭建
  - 配置CMake构建系统
  - 集成依赖库（GLFW、GLAD、GLM、stb_image）
  - 配置开发环境（Visual Studio / CLion / VS Code + CMake）
  - 创建OpenGL窗口和上下文（GLFW）
  - 初始化GLAD加载OpenGL函数指针
  - 配置OpenGL状态（版本、特性）

- [ ] **Day 3-4**: 基础渲染管线
  - 实现Shader加载系统（从文件读取GLSL）
  - 实现Shader编译和链接
  - 实现基础渲染循环（Render Loop）
  - 实现相机系统（Camera System）
  - 集成GLM数学库（MVP矩阵计算）

- [ ] **Day 5-7**: 基础几何体渲染
  - 实现立方体（Cube）渲染
  - 实现球体（Sphere）渲染
  - 实现圆柱（Cylinder）渲染
  - 实现圆锥（Cone）渲染
  - 实现多面棱柱（Prism）渲染
  - 实现多面棱台（Frustum）渲染

**交付物**: 能够渲染所有基本体素的引擎框架

---

#### 第2周：场景管理与变换系统
- [ ] **Day 1-3**: 场景图（Scene Graph）系统
  - 实现场景节点（Node）结构
  - 实现父子节点关系
  - 实现场景树遍历
  - 实现对象管理（Object Manager）

- [ ] **Day 4-5**: 几何变换系统（功能4）
  - 实现旋转（Rotation）功能
  - 实现平移（Translation）功能
  - 实现缩放（Scale）功能
  - 实现变换矩阵组合
  - 实现局部/世界坐标系转换

- [ ] **Day 6-7**: 基础材质系统
  - 实现材质数据结构
  - 实现基础颜色材质
  - 实现材质绑定到对象

**交付物**: 完整的场景管理和变换系统

---

### 第二阶段：核心功能实现（第3-4周）
**目标**: 完成所有基础功能要求

#### 第3周：材质纹理与存储（功能2、3）
- [ ] **Day 1-3**: 纹理系统
  - 使用stb_image加载纹理（PNG/JPG）
  - 实现纹理类封装（Texture类）
  - 实现纹理绑定和采样（glBindTexture）
  - 实现UV坐标映射
  - 实现纹理参数编辑（过滤、环绕模式）

- [ ] **Day 4-5**: 材质编辑系统（功能3）
  - 实现材质数据结构（Material类）
  - 实现材质属性编辑（环境光、漫反射、镜面反射）
  - 实现材质预览渲染
  - 实现材质序列化/反序列化（JSON或二进制）

- [ ] **Day 6-7**: 模型导入导出（功能2）
  - 实现OBJ格式解析器（手动解析或使用tinyobjloader）
  - 实现OBJ模型导入（顶点、法线、UV）
  - 实现OBJ模型导出
  - （可选）使用Assimp库支持更多格式（DAE、FBX等）

**交付物**: 完整的材质纹理系统和模型IO功能

---

#### 第4周：光照系统与漫游（功能5、6）
- [ ] **Day 1-3**: 光照模型实现（功能5）
  - 实现Phong光照模型
  - 实现环境光（Ambient Light）
  - 实现方向光（Directional Light）
  - 实现点光源（Point Light）
  - 实现聚光灯（Spot Light）

- [ ] **Day 4-5**: 光源编辑系统（功能5）
  - 实现光源参数调整（位置、强度、颜色）
  - 实现光源可视化（Gizmo显示）
  - 实现光源添加/删除
  - 实现光源属性面板

- [ ] **Day 6-7**: 场景漫游系统（功能6）
  - 实现Orbit控制（围绕目标旋转）
  - 实现Pan控制（平移视图）
  - 实现Zoom In/Out（缩放）
  - 实现Zoom To Fit（自适应视图）
  - 实现第一人称/第三人称切换

**交付物**: 完整的光照系统和场景漫游功能

---

### 第三阶段：记录功能与场景构建（第5-6周）
**目标**: 完成记录功能，开始游戏场景构建

#### 第5周：记录功能与动画（功能7）
- [ ] **Day 1-3**: 动画系统
  - 实现关键帧数据结构
  - 实现动画时间轴
  - 实现多帧数据连续绘制
  - 实现动画播放控制（播放/暂停/停止）

- [ ] **Day 4-5**: 屏幕截取功能（功能7）
  - 使用glReadPixels读取帧缓冲区
  - 实现截图保存为PNG/JPG（使用stb_image_write）
  - 实现截图格式选择
  - 实现截图快捷键（F12或自定义）

- [ ] **Day 6-7**: 场景编辑器基础
  - 实现对象选择系统（鼠标拾取）
  - 实现对象属性面板（使用ImGui或自定义UI）
  - 实现场景序列化/反序列化（使用nlohmann/json或自定义格式）

**交付物**: 完整的记录功能和基础编辑器

---

#### 第6周：游戏场景构建（核心场景）
- [ ] **Day 1-2**: 地形系统
  - 使用基本体素构建地形
  - 实现地面网格
  - 实现地形纹理映射

- [ ] **Day 3-4**: 建筑结构
  - 构建第一个篝火点（Checkpoint）
  - 构建第二个篝火点
  - 构建连接路径
  - 构建捷径通道

- [ ] **Day 5-6**: 场景装饰
  - 添加环境物体（柱子、墙壁、障碍物）
  - 添加场景细节（使用基本体素组合）
  - 优化场景性能

- [ ] **Day 7**: 场景测试与优化
  - 测试场景漫游流畅度
  - 优化渲染性能
  - 修复场景构建问题

**交付物**: 完整的游戏场景（2个篝火点+捷径）

---

### 第四阶段：游戏功能开发（第7-8周）
**目标**: 实现基础游戏交互，如时间不足则保留场景漫游

#### 第7周：基础交互系统
- [ ] **Day 1-2**: 输入系统
  - 实现键盘输入处理
  - 实现鼠标输入处理
  - 实现输入事件分发

- [ ] **Day 3-4**: 碰撞检测系统（高级功能2）
  - 实现AABB碰撞检测
  - 实现球体碰撞检测
  - 实现碰撞响应
  - 实现碰撞可视化（调试模式）

- [ ] **Day 5-7**: 角色控制器
  - 实现角色移动（WASD）
  - 实现角色旋转
  - 实现基础动画状态机
  - 实现角色与场景交互

**交付物**: 基础角色控制系统

---

#### 第8周：游戏机制与优化
**优先完成项**:
- [ ] **Day 1-2**: 篝火系统
  - 实现篝火交互（按E键）
  - 实现篝火保存点功能
  - 实现篝火重生机制

- [ ] **Day 3-4**: 战斗系统（如果时间允许）
  - 实现攻击动作
  - 实现防御动作
  - 实现翻滚动作
  - 实现伤害计算

- [ ] **Day 5-6**: 生命系统（如果时间允许）
  - 实现生命值显示
  - 实现回血机制
  - 实现死亡/重生

- [ ] **Day 7**: 最终优化与测试
  - 性能优化
  - Bug修复
  - 功能测试
  - 准备演示

**备选方案**（如果时间不足）:
- 保留完整的场景漫游功能
- 保留场景交互（如篝火交互）
- 简化或移除战斗系统
- 确保所有基础功能完整

**交付物**: 可玩的游戏原型或完整的场景演示

---

## 高级功能实现计划（额外加分项）

### 推荐实现的高级功能（按优先级）

1. **实时碰撞检测**（高级功能2）- 已在第7周实现
   - 难度：中等
   - 加分：5分
   - 状态：已规划

2. **对象表达能力**（高级功能7）- 场景构建时实现
   - 实现门、窗、墙等建筑对象
   - 难度：低-中等
   - 加分：5分
   - 实现时间：第6周

3. **复杂材质效果**（高级功能8）
   - 实现法线贴图（Normal Mapping）
   - 实现高光贴图（Specular Mapping）
   - 难度：中等
   - 加分：5分
   - 实现时间：第3周或第8周

4. **完整游戏构建**（高级功能5）
   - 如果完成所有游戏机制
   - 难度：高
   - 加分：5分
   - 实现时间：第7-8周

**目标**: 至少完成2-3个高级功能，争取满分40分

---

## 技术栈配置

### 核心技术栈：OpenGL + C++17
- **渲染API**: OpenGL 3.3+ / 4.6
- **编程语言**: C++17
- **窗口管理**: GLFW 3.3+
- **OpenGL加载器**: GLAD（或GL3W）
- **数学库**: GLM（OpenGL Mathematics）
- **图像加载**: stb_image（单头文件库）
- **图像保存**: stb_image_write
- **构建系统**: CMake 3.15+
- **JSON解析**: nlohmann/json（可选，用于场景序列化）
- **模型加载**: tinyobjloader（OBJ格式）或 Assimp（多格式）
- **UI框架**: Dear ImGui（用于编辑器界面，可选）

### 开发环境推荐

**Windows平台**:
- **IDE**: Visual Studio 2019/2022 或 CLion
- **编译器**: MSVC 或 MinGW-w64
- **调试器**: Visual Studio Debugger 或 GDB

**Linux平台**:
- **IDE**: CLion 或 VS Code + CMake插件
- **编译器**: GCC 9+ 或 Clang 10+
- **调试器**: GDB

**macOS平台**:
- **IDE**: Xcode 或 CLion
- **编译器**: Clang（Xcode Command Line Tools）
- **调试器**: LLDB

### 依赖库安装方式

**使用vcpkg（推荐）**:
```bash
vcpkg install glfw3 glad glm stb
```

**使用Conan**:
```bash
conan install glfw/3.3.8@
conan install glm/0.9.9.8@
```

**手动编译**: 参考各库的GitHub仓库说明

### 项目配置要点
- 确保OpenGL版本兼容性（最低3.3）
- 配置GLAD生成对应版本的加载器
- 设置正确的CMake目标链接库
- 配置资源文件路径（相对路径或资源目录）

### C++开发流程说明

**1. 开发环境搭建（第1周前完成）**
```bash
# Windows示例（使用vcpkg）
git clone https://github.com/Microsoft/vcpkg.git
cd vcpkg
.\bootstrap-vcpkg.bat
.\vcpkg integrate install
.\vcpkg install glfw3:x64-windows
.\vcpkg install glm:x64-windows
.\vcpkg install stb:x64-windows

# 配置CMake使用vcpkg
cmake -B build -S . -DCMAKE_TOOLCHAIN_FILE=[vcpkg根目录]/scripts/buildsystems/vcpkg.cmake
```

**2. 日常开发流程**
```
编写代码（.h/.cpp文件）
    ↓
保存文件
    ↓
编译（CMake + 编译器）
    ↓
生成可执行文件（.exe）
    ↓
运行程序
    ↓
查看结果/调试
```

**3. 编译命令示例**
```bash
# 配置项目
cmake -B build -S . -DCMAKE_BUILD_TYPE=Debug

# 编译
cmake --build build --config Debug

# 运行（Windows）
.\build\Debug\SoulsEngine.exe

# 运行（Linux/Mac）
./build/SoulsEngine
```

**4. 调试流程**
- **Visual Studio**: F5启动调试，F9设置断点，F10单步执行
- **CLion**: 点击行号设置断点，Shift+F9调试运行
- **GDB**: `gdb ./SoulsEngine` → `break main` → `run`

**5. OpenGL错误检查宏**
```cpp
#define GL_CHECK_ERROR() \
    do { \
        GLenum err = glGetError(); \
        if (err != GL_NO_ERROR) { \
            std::cerr << "OpenGL Error: " << err << " at " << __FILE__ << ":" << __LINE__ << std::endl; \
        } \
    } while(0)
```

---

## 项目结构建议

```
Souls-Engine/
├── CMakeLists.txt         # CMake主配置文件
├── cmake/                 # CMake模块
│   └── FindGLFW.cmake
├── src/
│   ├── core/              # 核心引擎
│   │   ├── Renderer.h/cpp # 渲染器
│   │   ├── Camera.h/cpp   # 相机系统
│   │   ├── Scene.h/cpp    # 场景管理
│   │   ├── Shader.h/cpp   # Shader管理
│   │   └── Window.h/cpp   # 窗口管理（GLFW封装）
│   ├── geometry/          # 几何体
│   │   ├── Mesh.h/cpp     # 网格基类
│   │   ├── Cube.h/cpp
│   │   ├── Sphere.h/cpp
│   │   ├── Cylinder.h/cpp
│   │   ├── Cone.h/cpp
│   │   ├── Prism.h/cpp
│   │   └── Frustum.h/cpp
│   ├── material/          # 材质系统
│   │   ├── Material.h/cpp
│   │   └── Texture.h/cpp
│   ├── lighting/          # 光照系统
│   │   ├── Light.h/cpp
│   │   └── PhongShader.h/cpp
│   ├── io/                # 导入导出
│   │   ├── OBJLoader.h/cpp
│   │   └── OBJExporter.h/cpp
│   ├── animation/         # 动画系统
│   │   └── Animation.h/cpp
│   ├── game/              # 游戏逻辑
│   │   ├── Player.h/cpp
│   │   ├── Checkpoint.h/cpp
│   │   └── Combat.h/cpp
│   ├── ui/                # UI系统（如果使用ImGui）
│   │   └── EditorUI.h/cpp
│   └── utils/             # 工具函数
│       ├── MathUtils.h/cpp
│       └── FileUtils.h/cpp
├── assets/                # 资源文件
│   ├── models/
│   ├── textures/
│   └── shaders/
│       ├── vertex.glsl
│       └── fragment.glsl
├── include/               # 第三方库头文件（如果需要）
│   ├── glad/
│   └── KHR/
├── lib/                   # 第三方库（Windows DLL等）
├── build/                 # 构建输出目录（gitignore）
└── README.md
```

### CMakeLists.txt 示例结构
```cmake
cmake_minimum_required(VERSION 3.15)
project(SoulsEngine)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# 查找依赖
find_package(glfw3 REQUIRED)
find_package(glm REQUIRED)

# 包含目录
include_directories(${CMAKE_SOURCE_DIR}/include)
include_directories(${CMAKE_SOURCE_DIR}/src)

# 源文件
file(GLOB_RECURSE SOURCES "src/*.cpp" "src/*.h")

# 可执行文件
add_executable(${PROJECT_NAME} ${SOURCES} src/main.cpp)

# 链接库
target_link_libraries(${PROJECT_NAME} 
    glfw
    ${CMAKE_DL_LIBS}  # 用于GLAD动态加载
)

# 资源文件复制（Windows）
if(WIN32)
    add_custom_command(TARGET ${PROJECT_NAME} POST_BUILD
        COMMAND ${CMAKE_COMMAND} -E copy_directory
        ${CMAKE_SOURCE_DIR}/assets $<TARGET_FILE_DIR:${PROJECT_NAME}>/assets
    )
endif()
```

---

## 里程碑检查点

### 里程碑1（第2周末）
- ? 所有基本体素可渲染
- ? 场景管理系统运行
- ? 基础变换功能完成

### 里程碑2（第4周末）
- ? 所有基础功能完成（功能1-6）
- ? 材质纹理系统完整
- ? 光照系统完整
- ? 漫游系统完整

### 里程碑3（第6周末）
- ? 记录功能完成（功能7）
- ? 游戏场景构建完成
- ? 所有基础要求满足（35分）

### 里程碑4（第8周末）
- ? 游戏交互功能完成（或场景演示完成）
- ? 高级功能实现（争取40分）
- ? 项目可演示

---

## 风险控制

### 主要风险
1. **时间不足**: 优先保证基础功能，游戏功能可简化
2. **性能问题**: 及时优化，控制场景复杂度
3. **技术难点**: 提前研究，预留缓冲时间
4. **环境配置**: C++项目配置较复杂，提前完成环境搭建
5. **内存管理**: C++需要手动管理内存，注意避免内存泄漏
6. **跨平台问题**: 不同平台OpenGL版本和扩展支持可能不同

### 应对策略
- **每周回顾**: 每周末检查进度，及时调整
- **功能优先级**: 基础功能 > 高级功能 > 游戏功能
- **备选方案**: 如果游戏功能来不及，保留完整场景漫游演示
- **环境准备**: 第1周前完成所有依赖库的安装和配置
- **代码审查**: 定期代码审查，确保代码质量和内存安全
- **工具使用**: 使用Valgrind（Linux）或Visual Studio诊断工具检查内存问题

---

## 分工建议（2人团队）

### 开发者A：引擎核心
- 负责：渲染管线、几何体、材质纹理、光照系统
- 时间：第1-4周主要工作
- 技能要求：熟悉OpenGL、GLSL、图形学基础

### 开发者B：功能与游戏
- 负责：模型IO、漫游系统、动画、游戏逻辑、UI系统
- 时间：第3-8周主要工作
- 技能要求：熟悉C++、文件IO、数学计算

### 协作部分
- 场景构建：共同完成
- 测试优化：共同完成
- 文档编写：共同完成

---

## 每周任务清单模板

### 第X周任务清单
- [ ] 任务1
- [ ] 任务2
- [ ] 任务3
- ...

**本周目标**: 
**完成度**: ___%

---

## 注意事项

1. **代码规范**: 
   - 统一代码风格（Google C++ Style Guide 或 LLVM Style）
   - 使用智能指针管理资源（避免内存泄漏）
   - 使用const正确性
   - 头文件保护（#pragma once 或 include guard）

2. **内存管理**:
   - 使用RAII原则
   - OpenGL资源（VAO、VBO、纹理）需要正确释放
   - 避免悬空指针和野指针

3. **版本控制**: 
   - 使用Git，每天提交代码
   - .gitignore包含build/、*.exe、*.dll等
   - 不要提交依赖库的二进制文件

4. **编译配置**:
   - Debug模式用于开发调试
   - Release模式用于性能测试和演示
   - 配置不同的CMake构建类型

5. **资源路径**:
   - 使用相对路径或资源目录
   - 确保运行时能找到shaders、textures等资源
   - Windows注意工作目录问题

6. **调试技巧**:
   - 使用GL_CHECK宏检查OpenGL错误
   - 使用RenderDoc进行图形调试
   - 使用断点和日志输出

7. **跨平台考虑**:
   - 路径分隔符（/ vs \）
   - 文件编码（UTF-8）
   - 库链接方式差异

---

## 总结

本计划确保：
- ? 所有7个基础功能完整实现（35分）
- ? 至少2-3个高级功能实现（额外5-10分）
- ? 完整的游戏场景构建
- ? 基础游戏交互（如时间允许）

**关键成功因素**:
1. 严格按照计划执行
2. 每周检查进度
3. 优先保证基础功能
4. 及时沟通协作

祝开发顺利！?

